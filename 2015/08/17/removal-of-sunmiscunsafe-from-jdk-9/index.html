<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.82.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:title" content="Java 9中将移除 Sun.misc.Unsafe(译)"><meta name=author content="Dongfang Qu"><meta name=keywords content="java9,,Unsafe，翻译"><meta name=description content="灾难将至，Java 9中将移除 Sun.misc.Unsafe
Oracle 正在计划在Java 9中去掉 sun.misc.Unsafe API。 这绝对将是一场灾难，有可能会彻底破坏整个 java 生态圈。 几乎每个使用 java开发的工具、软件基础设施、高性能开发库都在底层 …"><meta property="og:title" content="Java 9中将移除 Sun.misc.Unsafe(译)"><meta property="og:description" content="灾难将至，Java 9中将移除 Sun.misc.Unsafe
Oracle 正在计划在Java 9中去掉 <code>sun.misc.Unsafe</code> API。 这绝对将是一场灾难，有可能会彻底破坏整个 java 生态圈。 几乎每个使用 java开发的工具、软件基础设施、高性能开发库都在底层使用了 sun.misc.Unsafe。 如下是上面链接中文档提到部分使用Unsafe的软件或 lib：
  Netty Hazelcast Cassandra Mockito / EasyMock / JMock / PowerMock Scala Specs Spock Robolectric Grails Neo4j Spring Framework Akka Apache Kafka Apache Wink Apache Storm Apache Hadoop Apache Continuum   &mldr; 这个列表很长。。。
然而， Oracle 看起来是铁了心毫无理由的去掉它。下面是一个来自他们邮件列表的评论： n
 恕我直言 — sun.misc.Unsafe 必须死掉。 它是“不安全”的。它必须被废弃。请忽略一切理论上(想象中的)羁绊，从此走上正确的道路吧。
 这个工程师似乎是毫无根据的憎恨 Unsafe。。。
Oracle应该怎么做？ 当前Unsafe 类是一个强有力的工具。 没有必要去掉它。对这个类的特性有些明确的需求，这就是为什么事实上几乎每个 Java 程序都在使用它，不知不觉中许多流行的 Java库也在使用它。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.concurrent.work/2015/08/17/removal-of-sunmiscunsafe-from-jdk-9/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2015-08-17T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java 9中将移除 Sun.misc.Unsafe(译)"><meta name=twitter:description content="灾难将至，Java 9中将移除 Sun.misc.Unsafe
Oracle 正在计划在Java 9中去掉 <code>sun.misc.Unsafe</code> API。 这绝对将是一场灾难，有可能会彻底破坏整个 java 生态圈。 几乎每个使用 java开发的工具、软件基础设施、高性能开发库都在底层使用了 sun.misc.Unsafe。 如下是上面链接中文档提到部分使用Unsafe的软件或 lib：
  Netty Hazelcast Cassandra Mockito / EasyMock / JMock / PowerMock Scala Specs Spock Robolectric Grails Neo4j Spring Framework Akka Apache Kafka Apache Wink Apache Storm Apache Hadoop Apache Continuum   &mldr; 这个列表很长。。。
然而， Oracle 看起来是铁了心毫无理由的去掉它。下面是一个来自他们邮件列表的评论： n
 恕我直言 — sun.misc.Unsafe 必须死掉。 它是“不安全”的。它必须被废弃。请忽略一切理论上(想象中的)羁绊，从此走上正确的道路吧。
 这个工程师似乎是毫无根据的憎恨 Unsafe。。。
Oracle应该怎么做？ 当前Unsafe 类是一个强有力的工具。 没有必要去掉它。对这个类的特性有些明确的需求，这就是为什么事实上几乎每个 Java 程序都在使用它，不知不觉中许多流行的 Java库也在使用它。"><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.min.css crossorigin=anonymous><script defer src=/js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=/js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><title>Java 9中将移除 Sun.misc.Unsafe(译) | Concurrent Work</title></head><body><header><div id=titletext><h2 id=title><a href=https://www.concurrent.work>Concurrent Work</a></h2></div><div id=title-description><p id=subtitle>Rambling of a coder who craves for knowledge and understanding of the world.</p><div id=social><nav><ul><li><a href=https://github.com/qudongfang><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://www.linkedin.com/in/qudongfang/><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li><li><a href=https://twitter.com/qudongfang><i title=Twitter class="icons fab fa-twitter"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/posts>All Posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></header><main><div class=post><div class=author><p>Written by Dongfang Qu</p></div><div class=post-header><div class=meta><div class=date><span class=day>17</span>
<span class=rest>Aug 2015</span></div></div><div class=matter><h1 class=title>Java 9中将移除 Sun.misc.Unsafe(译)</h1></div></div><div class=markdown><p>灾难将至，Java 9中将移除 <code>Sun.misc.Unsafe</code></p><p>Oracle 正在<a href="https://docs.google.com/document/d/1GDm_cAxYInmoHMor-AkStzWvwE9pw6tnz_CebJQxuUE/edit?pli=1" target=_blank>计划在Java 9中去掉 &lt;code>sun.misc.Unsafe&lt;/code></a> API。
这绝对将是一场灾难，有可能会彻底破坏整个 java 生态圈。
几乎每个使用 java开发的工具、软件基础设施、高性能开发库都在底层使用了 <code>sun.misc.Unsafe</code>。
如下是上面链接中文档提到部分使用<code>Unsafe</code>的软件或 lib：</p><blockquote><ul><li>Netty</li><li>Hazelcast</li><li>Cassandra</li><li>Mockito / EasyMock / JMock / PowerMock</li><li>Scala Specs</li><li>Spock</li><li>Robolectric</li><li>Grails</li><li>Neo4j</li><li>Spring Framework</li><li>Akka</li><li>Apache Kafka</li><li>Apache Wink</li><li>Apache Storm</li><li>Apache Hadoop</li><li>Apache Continuum</li></ul></blockquote><p>&mldr; 这个列表很长。。。</p><p>然而， Oracle 看起来是铁了心毫无理由的去掉它。下面是一个来自他们<a href=http://mail.openjdk.java.net/pipermail/openjfx-dev/2015-April/017028.html target=_blank>邮件列表</a>的评论：
n</p><blockquote><p>恕我直言 — <code>sun.misc.Unsafe</code> 必须死掉。 它是“不安全”的。它必须被废弃。请忽略一切理论上(想象中的)羁绊，从此走上正确的道路吧。</p></blockquote><p>这个工程师似乎是毫无根据的憎恨 Unsafe。。。</p><h2 id=oracle应该怎么做>Oracle应该怎么做？</h2><p>当前Unsafe 类是一个强有力的工具。
没有必要去掉它。对这个类的特性有些明确的需求，这就是为什么事实上几乎每个 Java 程序都在使用它，不知不觉中许多流行的 Java库也在使用它。</p><h3 id=提供完整的文档发布-unsafe-类>提供完整的文档、发布 Unsafe 类</h3><p>Oracle 应该接受现实，并将Unsafe转为公开 API，提供完善的文档和开发示例。
当前，没有准确的文档，开发中需要通过 <a href=http://stackoverflow.com/questions/5574241/are-there-real-world-uses-of-sun-misc-unsafe target=_blank>stackoverflow 帖子</a>或者其他一些随机的博客学习怎么使用 <code>Unsafe</code>。
移除 <code>Unsafe</code> 的一个主要论据是：使用它太容易让开发中犯错了。如果有完善的官方文档或许可以改善这一现状。</p><h3 id=随-unsafe一起发布新的替代-api>随 Unsafe一起发布新的替代 API</h3><p>除了 <code>Unsafe</code> 文档外，Oracle 应该发布一个更易用的 API，提供 <code>Unsafe</code> 相同的功能。
这是上面文档中的提议的一部分。然而这不太应该以移除 <code>Unsafe</code> 为代价。
人们在开发新软件的时候就会逐步过渡到新的 API，<code>Unsafe</code> 就自动被废弃了。</p><p>这类似于向 Java 8引入 <code>java.time</code> 包中的新的 <code>DateTime</code> API。
新的日期 API 的引入并不表示之前的<code>DateTime</code> API 被彻底移除或者隐藏到某个特殊 JVM flag 里。那样也肯定会引发一些事故。</p><h2 id=实际上最可能会变成什么样子>实际上最可能会变成什么样子？</h2><p>根据事情的发展趋势，Oracle 看起来会：</p><blockquote><ol><li>在 Java 9正常模式下移除 <code>Unsafe</code> 类。</li><li>仅在必须的情况下通过向 JVM 传递一个特殊的 flag 启动 <code>Unsafe</code></li></ol></blockquote><h2 id=这将导致绝对的灾难>这将导致绝对的灾难！</h2><ul><li>不仅类似 Cassandra 或Zookeeper 等基础软件，几乎所有的 Java 程序，包括 web 应用也会挂掉，因为他们使用的基础库可能在底层使用了 <code>Unsafe</code>。</li><li>从此打开 Unsafe flag 将会成为启动 JVM 的默认 flag 之一，因为如果不打开它的话 Java 应用会在毫无提示的情况下崩溃。</li><li>因为大多数环境不会默认把这个JVM flag 打开，当他们的系统升级 Java时软件系统会挂掉。
Java 打破了向后兼容的承诺。所有的基础库、软件基础设施从此变为两个版本：<ul><li>Java 9之前的版本 - 使用 <code>Unsafe</code></li><li>Java 9兼容 - 不使用 <code>Unsafe</code>。</li></ul></li><li>迁移至 Java 9的进程会因此而变缓慢，这将影响整个 Java 生态系统。这将会类似于 Python 2升级到 Python 3的过程。</li></ul><h2 id=这种错误-jvm-社区之前曾经犯过>这种错误 JVM 社区之前曾经犯过</h2><p>你是不是任务这太荒唐了，Oracle 绝不可能犯这样的错误？事实上它曾做过类似的事情了，
例如<a href=http://chrononsystems.com/blog/java-7-design-flaw-leads-to-huge-backward-step-for-the-jvm target=_blank>Java 7中的字节码校验器</a>。</p><h2 id=结论>结论</h2><p>现在是该让大家开始意识到这个问题的时候了。从 JVM中去掉<code>Unsafe</code>或者把它隐藏在某个特殊的 flag 里面势必导致一场灾难。</p><h2 id=参考链接>参考链接</h2><ul><li><a href=http://blog.dripstat.com/removal-of-sun-misc-unsafe-a-disaster-in-the-making/ target=_blank>原文</a></li><li><a href=http://www.infoq.com/cn/news/2015/08/oracle-plan-remove-unsafe target=_blank>infoq 报道</a></li><li><a href=http://www.itupup.com/?it08/523957.htm target=_blank>itupup 报道</a></li></ul></div><div class=tags><div class=taxosfloating_left><p>Categories</p></div><div class=termsfloating_right><p><a href=/categories/9/>9</a>
<a href=/categories/java/>java</a>
<a href=/categories/unsafe/>unsafe</a></p></div><div class=clearit></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/java9/>java9</a>
<a href=/tags/unsafe%e7%bf%bb%e8%af%91/>unsafe翻译</a></p></div><div class=clearit></div></div></div></main><footer>©Copyright | <a href=https://github.com/qudongfang/>Concurrent work</a></footer></body></html>